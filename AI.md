# AI Integration Documentation

## –û–±–∑–æ—Ä

–ë–æ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å AI —Å–µ—Ä–≤–∏—Å–æ–º –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

–î–ª—è —Ä–∞–±–æ—Ç—ã AI —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º API –∫–ª—é—á –æ—Ç [OpenRouter](https://openrouter.ai/):

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://openrouter.ai/
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª Keys
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á
4. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å (–º–Ω–æ–≥–∏–µ –º–æ–¥–µ–ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à `.env` —Ñ–∞–π–ª:

```env
AI_API_KEY=your_actual_api_key_here
AI_BASE_URL=https://openrouter.ai/api/v1
```

### 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –º–æ–¥–µ–ª—å

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å: **google/gemini-2.0-flash-exp:free**

–≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –æ—Ç Google, –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∞—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á.

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –≤ `ai/service.py`:

```python
# –î—Ä—É–≥–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏:
self.model = "deepseek/deepseek-chat"
self.model = "meta-llama/llama-3.2-3b-instruct:free"
self.model = "microsoft/phi-3-mini-128k-instruct:free"
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
ai/
‚îú‚îÄ‚îÄ __init__.py      # –≠–∫—Å–ø–æ—Ä—Ç AIService
‚îî‚îÄ‚îÄ service.py       # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å AIService
```

### AIService –∫–ª–∞—Å—Å

**–ú–µ—Ç–æ–¥—ã:**
- `__init__()` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AsyncOpenAI –∫–ª–∏–µ–Ω—Ç–∞
- `generate_response(user_message: str) -> str` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `system_prompt` - –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
- `model` - –ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –º–æ–¥–µ–ª—å
- `max_tokens` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 500)
- `temperature` - –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ (0.7)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö

```python
from ai import AIService

ai_service = AIService()

@router.message(F.text)
async def handler(message: Message):
    # –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç..."
    await message.bot.send_chat_action(
        chat_id=message.chat.id,
        action=ChatAction.TYPING
    )
    
    # –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç AI
    try:
        response = await ai_service.generate_response(message.text)
        await message.answer(response)
    except Exception:
        await message.answer("–ú–æ–∑–≥–∏ –ø–µ—Ä–µ–≥—Ä–µ–ª–∏—Å—å, –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ...")
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –æ—à–∏–±–∫–∏ API –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
ü§ñ –ú–æ–∑–≥–∏ –ø–µ—Ä–µ–≥—Ä–µ–ª–∏—Å—å, –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ... üî•
–ö–∞–∂–µ—Ç—Å—è, —É –º–µ–Ω—è –Ω–µ–±–æ–ª—å—à–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã.
```

–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.env` —Ñ–∞–π–ª–µ (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `os.getenv()` –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `.env` —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.clineignore` –∏ `.gitignore`

## Customization

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

–í `ai/service.py`:

```python
self.system_prompt = (
    "–¢–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∑–¥–µ—Å—å... "
    "–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞."
)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```python
response = await self.client.chat.completions.create(
    model=self.model,
    messages=[...],
    max_tokens=1000,      # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞
    temperature=0.9,      # –ë–æ–ª–µ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    top_p=0.95,          # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
)
```

## Troubleshooting

### "AI_API_KEY is not set"
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` —Ñ–∞–π–ª–µ –µ—Å—Ç—å `AI_API_KEY=–≤–∞—à_–∫–ª—é—á`

### "–ú–æ–∑–≥–∏ –ø–µ—Ä–µ–≥—Ä–µ–ª–∏—Å—å"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ OpenRouter
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ (–Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∞)

### –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å
- –£–º–µ–Ω—å—à–∏—Ç–µ `max_tokens`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

## –°—Ç–æ–∏–º–æ—Å—Ç—å

–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏:
- ‚úÖ google/gemini-2.0-flash-exp:free
- ‚úÖ deepseek/deepseek-chat (—Ç–∞–∫–∂–µ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è)

–ü–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –æ–±—ã—á–Ω–æ –¥–µ—à–µ–≤–ª–µ $0.001 –∑–∞ –∑–∞–ø—Ä–æ—Å.
